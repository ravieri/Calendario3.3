<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calend√°rio de Partidas</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- tsParticles for background effects -->
    <script src="https://cdn.jsdelivr.net/npm/tsparticles-slim@2.12.0/tsparticles.slim.bundle.min.js"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        .calendar-day { transition: all 0.2s ease-in-out; }
        .calendar-day.has-events { cursor: pointer; background-color: #1f2937; }
        .calendar-day.has-events:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(79, 70, 229, 0.5); }
        .calendar-day.today { border: 2px solid #4f46e5; }

        #day-details-panel { transition: transform 0.3s ease-in-out; transform: translateX(100%); z-index: 50; }
        #day-details-panel.open { transform: translateX(0); }

        #sidebar { transition: transform 0.3s ease-in-out, width 0.3s ease-in-out; z-index: 40; }
        #sidebar.collapsed { transform: translateX(-100%); width: 0; padding: 0; }
        
        /* Novo estilo para o cont√™iner de part√≠culas do calend√°rio */
        #calendar-background-particles {
            position: absolute;
            top: 50%; /* Centraliza verticalmente */
            left: 50%; /* Centraliza horizontalmente */
            transform: translate(-50%, -50%); /* Ajusta para centraliza√ß√£o verdadeira */
            width: 80%; /* Largura ajustada para o notebook */
            height: 80%; /* Altura ajustada para o notebook */
            max-width: 1000px; /* Limita a largura m√°xima */
            max-height: 600px; /* Limita a altura m√°xima */
            z-index: 0; /* Garante que fique atr√°s do conte√∫do do calend√°rio */
            border-radius: 50%; /* Opcional: para dar um formato circular ao cont√™iner de part√≠culas */
        }

        .reminder-bell.active { color: #facc15; } /* yellow-400 */
    </style>
</head>
<body class="text-gray-200">
    
    <!-- Removido: <div id="tsparticles"></div> -->

    <div class="flex h-screen overflow-hidden">
        <aside id="sidebar" class="w-72 bg-gray-900 p-6 flex flex-col space-y-6 overflow-y-auto">
            <h2 class="text-2xl font-bold text-white whitespace-nowrap">Navega√ß√£o</h2>
            <nav>
                <ul>
                    <li><a href="partidas.html" class="block py-2 px-4 rounded-lg bg-indigo-600 text-white">Calend√°rio de Partidas</a></li>
                    <li><a href="eventos.html" class="block py-2 px-4 rounded-lg hover:bg-gray-700">Eventos</a></li>
                </ul>
            </nav>

            <hr class="border-gray-700">

            <h2 class="text-2xl font-bold text-white whitespace-nowrap">Filtros</h2>

            <div>
                <label for="view-mode" class="block text-sm font-medium text-gray-400 mb-2 whitespace-nowrap">Mostrar eventos:</label>
                <select id="view-mode" class="w-full bg-gray-800 border-gray-700 rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="principais">Principais Eventos (Filtrados)</option>
                    <option value="todos">Todos os Eventos</option>
                    <option value="lembretes">Meus Lembretes üîî</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-2 whitespace-nowrap">Per√≠odo:</label>
                <div class="flex space-x-4">
                    <label class="flex items-center"><input type="radio" name="event-period" value="upcoming" class="text-indigo-600 bg-gray-700 border-gray-600 focus:ring-indigo-500" checked><span class="ml-2">Pr√≥ximos</span></label>
                    <label class="flex items-center"><input type="radio" name="event-period" value="past" class="text-indigo-600 bg-gray-700 border-gray-600 focus:ring-indigo-500"><span class="ml-2">Anteriores</span></label>
                </div>
            </div>

            <div id="team-search-container">
                <label for="team-search" class="block text-sm font-medium text-gray-400 mb-2 whitespace-nowrap">Buscar por time:</label>
                <div class="relative">
                    <input type="text" id="team-search" placeholder="Ex: Palmeiras" class="w-full bg-gray-800 border-gray-700 rounded-lg p-2 focus:ring-indigo-500 focus:border-indigo-500" autocomplete="off">
                    <div id="autocomplete-results" class="absolute z-20 w-full bg-gray-700 rounded-b-lg shadow-lg hidden max-h-60 overflow-y-auto"></div>
                </div>
            </div>

            <div id="hot-games-filter-container" class="whitespace-nowrap">
                 <label for="hot-games-toggle" class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="hot-games-toggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                    <span class="ml-3 text-sm font-medium text-gray-300">Apenas Jogos Quentes üî•</span>
                </label>
            </div>

            <div id="sport-filters" class="whitespace-nowrap">
                <h3 class="text-lg font-semibold text-white mb-2">Esportes</h3>
            </div>

            <div id="league-filters" class="whitespace-nowrap hidden">
                <h3 class="text-lg font-semibold text-white mb-2">Campeonatos</h3>
                <select id="league-select" multiple class="w-full bg-gray-800 border-gray-700 rounded-lg p-2 h-48 focus:ring-indigo-500 focus:border-indigo-500"></select>
            </div>
            
            <div id="save-status-container" class="mt-auto pt-4 border-t border-gray-700">
                 <p id="save-status" class="text-sm text-yellow-400 h-5 text-center whitespace-nowrap"></p>
            </div>
        </aside>

        <!-- √ÅREA PRINCIPAL -->
        <main class="flex-1 p-8 overflow-y-auto relative">
            <button id="sidebar-toggle" class="absolute top-6 left-6 z-30 p-2 rounded-full bg-gray-800 hover:bg-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
            </button>

            <div class="flex items-center justify-center mb-6">
                <h1 class="text-3xl font-bold text-white">Calend√°rio de Partidas</h1>
            </div>

            <!-- Novo cont√™iner para as part√≠culas ao redor do calend√°rio -->
            <div id="calendar-background-particles"></div>
            
            <div id="calendars-container" class="relative flex justify-center items-start">
                <!-- Bot√µes de navega√ß√£o reposicionados dentro do calendars-container -->
                <button id="prev-month" class="absolute top-0 left-0 p-2 rounded-full hover:bg-gray-700 z-10 mt-4 ml-4 text-white">&lt;</button>
                <button id="next-month" class="absolute top-0 right-0 p-2 rounded-full hover:bg-gray-700 z-10 mt-4 mr-4 text-white">&gt;</button>

                <div id="next-event-prompt" class="absolute inset-0 flex-col items-center justify-center bg-black bg-opacity-75 hidden z-20 rounded-lg p-8 text-center">
                    <p id="prompt-title" class="text-2xl font-bold text-white mb-4"></p>
                    <button id="jump-to-event-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg text-lg flex items-center transition-transform transform hover:scale-105">
                        <span id="jump-text"></span><span id="jump-date" class="ml-2 font-black"></span><svg id="jump-arrow" class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"></svg>
                    </button>
                </div>
                
                <div id="calendar-1" class="w-full max-w-xl px-4"><h2 id="month-year-1" class="text-2xl font-bold text-center mb-4"></h2><div class="grid grid-cols-7 gap-4 text-center text-gray-400 font-semibold mb-2"><div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div></div><div id="calendar-grid-1" class="grid grid-cols-7 gap-4"></div></div>
                <div class="h-auto self-stretch border-l border-gray-700 mx-4"></div>
                <div id="calendar-2" class="w-full max-w-xl px-4"><h2 id="month-year-2" class="text-2xl font-bold text-center mb-4"></h2><div class="grid grid-cols-7 gap-4 text-center text-gray-400 font-semibold mb-2"><div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div></div><div id="calendar-grid-2" class="grid grid-cols-7 gap-4"></div></div>
            </div>

            <div id="loading-indicator" class="text-center py-10 hidden">Carregando eventos...</div>
        </main>
    </div>

    <!-- PAINEL LATERAL DE DETALHES DO DIA -->
    <div id="day-details-panel" class="fixed top-0 right-0 h-full w-full max-w-md bg-gray-800 shadow-lg p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-6"><h2 id="details-title" class="text-2xl font-bold text-white">Eventos do Dia</h2><button id="close-details" class="p-2 rounded-full hover:bg-gray-700">X</button></div>
        <div id="details-content" class="space-y-4"></div>
    </div>
    
    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed bottom-5 right-5 w-full max-w-sm space-y-4 z-50">
        <div id="welcome-toast" class="bg-gray-800 rounded-lg shadow-lg text-white hidden transform transition-all duration-300 translate-y-16 p-4">
            <div class="flex justify-between items-start"><div class="flex-1"><h3 class="font-bold">üî• Fique de Olho!</h3><p id="toast-message" class="text-sm mt-1 whitespace-pre-wrap"></p></div><button id="close-toast" class="ml-2 text-gray-400 hover:text-white text-2xl leading-none">&times;</button></div>
        </div>
         <div id="reminder-toast" class="bg-indigo-700 rounded-lg shadow-lg text-white hidden transform transition-all duration-300 translate-y-16 p-4">
            <div class="flex justify-between items-start"><div class="flex-1"><h3 class="font-bold">üîî Lembretes para Hoje!</h3><p id="reminder-message" class="text-sm mt-1 whitespace-pre-wrap"></p></div><button id="close-reminder-toast" class="ml-2 text-gray-400 hover:text-white text-2xl leading-none">&times;</button></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // --- CONFIGURA√á√ÉO ---
            const API_KEY = '373862';
            const CACHE_DURATION_MINUTES = 15;
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz5aInrAmXeUCwn40ybZVbx8efrQQyAw6BvUnHYG9X_MLkmjHCFBtjwMVROZZDzgTTl/exec';

            const sportConfigs = {
                'Futebol': { color: 'bg-blue-500', particleColor: '#3b82f6', backgroundImage: 'url(https://images.unsplash.com/photo-1508098682722-e99c43a406b2?q=80&w=1000&auto=format&fit=crop)', leagues: { 'serie_a': { id: '4351', name: 'Brasileir√£o S√©rie A' },'copa_do_brasil': { id: '4725', name: 'Copa do Brasil' },'libertadores': { id: '4501', name: 'Copa Libertadores' },'sudamericana': { id: '4724', name: 'Copa Sudamericana' },'premier_league': { id: '4328', name: 'English Premier League' },'la_liga': { id: '4335', name: 'Spanish La Liga' },'serie_a_italy': { id: '4332', name: 'Italian Serie A' },'primeira_liga': { id: '4344', name: 'Portuguese Primeira Liga' },'champions_league': { id: '4480', name: 'UEFA Champions League' },'copa_america': { id: '4499', name: 'Copa America' },'world_cup': { id: '4429', name: 'FIFA World Cup' },'mundial_clubes': { id: '4503', name: 'FIFA Club World Cup' } } },
                'Basquete': { color: 'bg-orange-500', particleColor: '#f97316', backgroundImage: 'url(https://images.unsplash.com/photo-1574313433589-9b3575d5a711?q=80&w=1000&auto=format&fit=crop)', leagues: { 'nba': { id: '4387', name: 'NBA' } } },
                'T√™nis': { color: 'bg-lime-500', particleColor: '#84cc16', backgroundImage: 'url(https://images.unsplash.com/photo-1554062234-3180f9344402?q=80&w=1000&auto=format&fit=crop)', leagues: { 'atp_world_tour': { id: '4464', name: 'ATP World Tour' }, 'wta_tour': { id: '4517', name: 'WTA Tour' } } },
            };
            
            const topTeams = [
                'Palmeiras', 'Flamengo', 'Corinthians', 'Sao Paulo', 'Santos', 'Gremio', 
                'Internacional', 'Atletico Mineiro', 'Cruzeiro', 'Vasco da Gama', 'Fluminense', 
                'Botafogo', 'Athletico Paranaense', 'Boca Juniors', 'River Plate', 'Racing Club', 'Independiente',
                'Penarol', 'Nacional', 'Atletico Nacional', 'LDU Quito',
                'Manchester City', 'Liverpool', 'Chelsea', 'Manchester United', 'Arsenal', 'Tottenham',
                'Real Madrid', 'Barcelona', 'Atletico Madrid', 'Sevilla',
                'Juventus', 'Inter', 'AC Milan', 'Napoli', 'Roma', 'Lazio', 'Fiorentina',
                'Bayern Munich', 'Borussia Dortmund', 'Paris Saint-Germain', 'Marseille', 'Lyon',
                'Benfica', 'Porto', 'Sporting CP', 'Ajax', 'Al Hilal', 'Al Ahly', 
                'Brazil', 'Argentina', 'France', 'Germany', 'Spain', 'England', 'Portugal', 'Italy', 'Netherlands', 'Uruguay', 'Belgium', 'Croatia'
            ];

            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const loadingIndicator = document.getElementById('loading-indicator');
            const detailsPanel = document.getElementById('day-details-panel');
            const detailsTitle = document.getElementById('details-title');
            const detailsContent = document.getElementById('details-content');
            const closeDetailsBtn = document.getElementById('close-details');
            const sidebar = document.getElementById('sidebar');
            const sidebarToggleBtn = document.getElementById('sidebar-toggle');
            const nextEventPrompt = document.getElementById('next-event-prompt');
            const saveStatus = document.getElementById('save-status');
            const viewModeSelect = document.getElementById('view-mode');
            const teamSearchInput = document.getElementById('team-search');
            const autocompleteResults = document.getElementById('autocomplete-results');
            const sportFiltersContainer = document.getElementById('sport-filters');
            const leagueFiltersContainer = document.getElementById('league-filters');
            const leagueSelect = document.getElementById('league-select');
            const hotGamesToggle = document.getElementById('hot-games-toggle');

            let currentDate = new Date();
            let allEventsData = { upcoming: null, past: null };
            let eventPeriod = 'upcoming';
            let savedReminders = JSON.parse(localStorage.getItem('eventReminders')) || [];

            const getCache = key => {
                const itemStr = localStorage.getItem(key);
                if (!itemStr) return null;
                const item = JSON.parse(itemStr);
                if (new Date().getTime() > item.expiry) {
                    localStorage.removeItem(key); return null;
                }
                return item.value;
            };

            const setCache = (key, value) => {
                const item = { value, expiry: new Date().getTime() + CACHE_DURATION_MINUTES * 60 * 1000 };
                localStorage.setItem(key, JSON.stringify(item));
            };
            
            async function saveToSheets(events) {
                if (!GOOGLE_SCRIPT_URL || !events || events.length === 0) return;
                saveStatus.textContent = 'Sincronizando com hist√≥rico...';
                saveStatus.className = 'text-yellow-400 text-sm h-5 text-center whitespace-nowrap';
                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST', mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ events }),
                    });
                    saveStatus.textContent = 'Hist√≥rico sincronizado!';
                    saveStatus.className = 'text-green-400 text-sm h-5 text-center whitespace-nowrap';
                } catch (error) {
                    console.error('Failed to save to sheets:', error);
                    saveStatus.textContent = 'Erro ao sincronizar.';
                    saveStatus.className = 'text-red-400 text-sm h-5 text-center whitespace-nowrap';
                }
            }
            
            function showToast(toastId, message) {
                const toast = document.getElementById(toastId);
                const messageEl = toast.querySelector('p');
                const closeBtn = toast.querySelector('button');

                messageEl.textContent = message;
                toast.classList.remove('hidden');
                setTimeout(() => toast.classList.remove('translate-y-16'), 100);

                const closeHandler = () => {
                    toast.classList.add('translate-y-16');
                    setTimeout(() => toast.classList.add('hidden'), 300);
                    document.body.removeEventListener('click', closeHandler, true);
                };

                closeBtn.onclick = (e) => { e.stopPropagation(); closeHandler(); };
                setTimeout(() => document.body.addEventListener('click', closeHandler, true), 50);
                toast.addEventListener('click', e => e.stopPropagation());
            }

            function checkAndNotify() {
                // Notifica√ß√£o de Jogos Salvos para Hoje
                const todayStr = new Date().toISOString().split('T')[0];
                const todaysReminders = savedReminders
                    .map(id => (allEventsData.upcoming || []).find(e => e.idEvent === id))
                    .filter(event => event && event.dateEvent === todayStr);

                if (todaysReminders.length > 0) {
                     let message = "Lembretes para hoje:\n";
                    todaysReminders.forEach(event => { message += `- ${event.strEvent}\n`; });
                    showToast('reminder-toast', message.trim());
                }
                
                // Notifica√ß√£o de Jogos Quentes da Semana
                const today = new Date(); today.setHours(0, 0, 0, 0);
                const nextWeek = new Date(); nextWeek.setDate(today.getDate() + 7);

                const upcomingHotGames = (allEventsData.upcoming || [])
                    .filter(e => {
                        const eventDate = new Date(e.dateEvent + 'T00:00:00');
                        return topTeams.includes(e.strHomeTeam) && topTeams.includes(e.strAwayTeam) && eventDate >= today && eventDate <= nextWeek;
                    })
                    .sort((a,b) => new Date(a.dateEvent) - new Date(b.dateEvent));
                
                if (upcomingHotGames.length > 0) {
                    let message = "Pr√≥ximos Jogos Quentes:\n";
                    upcomingHotGames.slice(0, 3).forEach(event => { message += `- ${event.strEvent}\n`; });
                    setTimeout(() => showToast('welcome-toast', message.trim()), 1500); // Atraso para n√£o sobrepor
                }
            }

            async function fetchAllEventsForPeriod() {
                loadingIndicator.style.display = 'block';
                const cacheKey = `all_events_cache_${eventPeriod}`;
                let cachedEvents = getCache(cacheKey);

                if (cachedEvents) {
                    allEventsData[eventPeriod] = cachedEvents;
                } else {
                    const endpointType = eventPeriod === 'upcoming' ? 'eventsnextleague' : 'eventspastleague';
                    const promises = [];
                    for (const sportName in sportConfigs) {
                        for (const leagueKey in sportConfigs[sportName].leagues) {
                            const leagueId = sportConfigs[sportName].leagues[leagueKey].id;
                            const url = `https://www.thesportsdb.com/api/v1/json/${API_KEY}/${endpointType}.php?id=${leagueId}`;
                            promises.push(fetch(url).then(res => res.json()).catch(err => ({ events: [] })));
                        }
                    }
                    const results = await Promise.all(promises);
                    const fetchedEvents = results.flatMap(result => result.events || []);
                    allEventsData[eventPeriod] = fetchedEvents;
                    setCache(cacheKey, fetchedEvents);
                    saveToSheets(fetchedEvents);
                }
                
                loadingIndicator.style.display = 'none';
                applyFiltersAndRender();
                if(eventPeriod === 'upcoming') checkAndNotify();
            }
            
            async function loadParticles(colors = ["#ffffff"]) {
                await tsParticles.load("calendar-background-particles", { // Target the new div
                    fpsLimit: 60,
                    particles: {
                        number: { value: 30, density: { enable: true, value_area: 400 } }, // Reduced number and density
                        color: { value: colors },
                        shape: { type: "circle" },
                        opacity: { value: 0.3, random: true }, // Slightly less opaque
                        size: { value: 2, random: { enable: true, minimumValue: 1 } }, // Smaller particles
                        move: {
                            enable: true,
                            speed: 0.5, // Slower movement
                            direction: "none",
                            random: true,
                            straight: false,
                            out_mode: "bounce", // Keep them within the container
                            bounce: true
                        },
                        links: { enable: true, distance: 100, color: "#ffffff", opacity: 0.1, width: 1 } // Shorter links, less opaque
                    },
                    interactivity: {
                        events: {
                            onHover: { enable: true, mode: "grab" },
                            onClick: { enable: true, mode: "push" }
                        },
                        modes: {
                            grab: { distance: 100, links: { opacity: 0.2 } }, // Reduced grab distance
                            push: { quantity: 1 } // Push fewer particles
                        }
                    },
                    detectRetina: true
                });
            }

            function renderSingleCalendar(gridId, monthYearId, month, year, events) {
                const grid = document.getElementById(gridId);
                const monthYearEl = document.getElementById(monthYearId);
                
                grid.innerHTML = '';
                monthYearEl.textContent = `${new Date(year, month).toLocaleString('pt-BR', { month: 'long' })} de ${year}`;
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDay; i++) { grid.insertAdjacentHTML('beforeend', '<div></div>'); }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day border border-gray-700 rounded-lg p-2 h-20 flex flex-col';
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const eventsOnDay = events.filter(e => e.dateEvent === dateStr);
                    
                    const isHotDay = eventsOnDay.some(e => topTeams.includes(e.strHomeTeam) && topTeams.includes(e.strAwayTeam));
                    dayEl.innerHTML = `<div class="flex justify-between items-start"><span class="font-bold">${day}</span>${isHotDay ? '<span>üî•</span>' : ''}</div>`;

                    if (eventsOnDay.length > 0) {
                        dayEl.classList.add('has-events');
                        dayEl.dataset.date = dateStr;
                        
                        const indicators = document.createElement('div');
                        indicators.className = 'flex items-center space-x-1 mt-auto';
                        
                        const sportsOnDay = [...new Set(eventsOnDay.map(e => getSportByLeagueId(e.idLeague)))];
                        sportsOnDay.forEach(sportName => {
                            if (sportName) indicators.innerHTML += `<div class="w-2 h-2 rounded-full ${sportConfigs[sportName]?.color || 'bg-gray-500'}"></div>`;
                        });

                        dayEl.appendChild(indicators);
                        dayEl.addEventListener('click', () => showDayDetails(dateStr, events));
                    }
                    
                    const today = new Date();
                    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        dayEl.classList.add('today');
                    }
                    grid.appendChild(dayEl);
                }
            }
            
            function renderTwoMonths(date, events) {
                const month1 = date.getMonth();
                const year1 = date.getFullYear();
                renderSingleCalendar('calendar-grid-1', 'month-year-1', month1, year1, events);
                const date2 = new Date(date);
                date2.setMonth(date2.getMonth() + 1);
                const month2 = date2.getMonth();
                const year2 = date2.getFullYear();
                renderSingleCalendar('calendar-grid-2', 'month-year-2', month2, year2, events);
            }

            function populateFilters() {
                let sportHtml = '';
                leagueSelect.innerHTML = '';
                
                for (const sportName in sportConfigs) {
                    sportHtml += `<label class="flex items-center space-x-2"><input type="checkbox" value="${sportName}" class="sport-filter bg-gray-700 border-gray-600 rounded"><span>${sportName}</span></label>`;
                    
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = sportName;
                    optgroup.dataset.sport = sportName;
                    
                    if (sportConfigs[sportName].leagues) {
                        for (const leagueKey in sportConfigs[sportName].leagues) {
                            const league = sportConfigs[sportName].leagues[leagueKey];
                            const option = document.createElement('option');
                            option.value = league.id;
                            option.textContent = league.name;
                            optgroup.appendChild(option);
                        }
                    }
                    leagueSelect.appendChild(optgroup);
                }
                sportFiltersContainer.innerHTML = '<h3 class="text-lg font-semibold text-white mb-2">Esportes</h3>' + sportHtml;

                document.querySelectorAll('.sport-filter').forEach(el => el.addEventListener('change', updateLeagueFilterVisibility));
                leagueSelect.addEventListener('change', applyFiltersAndRender);
            }

            function updateLeagueFilterVisibility() {
                const selectedSports = [...document.querySelectorAll('.sport-filter:checked')].map(el => el.value);
                
                leagueFiltersContainer.classList.toggle('hidden', selectedSports.length === 0);

                document.querySelectorAll('#league-select optgroup').forEach(optgroup => {
                    const shouldShow = selectedSports.includes(optgroup.dataset.sport);
                    optgroup.style.display = shouldShow ? 'block' : 'none';
                    if (!shouldShow) {
                        optgroup.querySelectorAll('option').forEach(option => option.selected = false);
                    }
                });

                const particleColors = selectedSports.length > 0 ? selectedSports.map(sport => sportConfigs[sport]?.particleColor || '#ffffff') : ['#ffffff'];
                loadParticles(particleColors);
                
                applyFiltersAndRender();
            }
            
            function applyFiltersAndRender() {
                nextEventPrompt.classList.add('hidden');
                let eventsToRender = allEventsData[eventPeriod] || [];
                const mode = viewModeSelect.value;
                
                if (mode === 'lembretes') {
                    eventsToRender = (allEventsData[eventPeriod] || []).filter(e => savedReminders.includes(e.idEvent));
                } else if (mode === 'principais') {
                    const searchTerm = teamSearchInput.value.toLowerCase();
                    const selectedSports = [...document.querySelectorAll('.sport-filter:checked')].map(el => el.value);
                    const selectedLeagues = [...leagueSelect.selectedOptions].map(opt => opt.value);
                    const showOnlyHotGames = hotGamesToggle.checked;
                    
                    if (selectedSports.length > 0) eventsToRender = eventsToRender.filter(e => selectedSports.includes(getSportByLeagueId(e.idLeague)));
                    if (selectedLeagues.length > 0) eventsToRender = eventsToRender.filter(e => selectedLeagues.includes(e.idLeague));
                    if (searchTerm) eventsToRender = eventsToRender.filter(e => (e.strHomeTeam?.toLowerCase().includes(searchTerm) || e.strAwayTeam?.toLowerCase().includes(searchTerm)));
                    if (showOnlyHotGames) eventsToRender = eventsToRender.filter(e => topTeams.includes(e.strHomeTeam) && topTeams.includes(e.strAwayTeam));
                }
                
                renderTwoMonths(currentDate, eventsToRender);
                
                const firstDayOfView = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                const lastDayOfView = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0);

                const hasEventsInView = eventsToRender.some(e => new Date(e.dateEvent + 'T00:00:00') >= firstDayOfView && new Date(e.dateEvent + 'T00:00:00') <= lastDayOfView);
                
                if (!hasEventsInView && eventsToRender.length > 0) {
                    const sortedEvents = eventsToRender.map(e => ({ ...e, dateObj: new Date(e.dateEvent + 'T00:00:00')}))
                        .sort((a,b) => eventPeriod === 'upcoming' ? a.dateObj - b.dateObj : b.dateObj - a.dateObj);
                    
                    const nextEvent = eventPeriod === 'upcoming' 
                        ? sortedEvents.find(e => e.dateObj > lastDayOfView)
                        : sortedEvents.find(e => e.dateObj < firstDayOfView);

                    if(nextEvent) {
                        document.getElementById('prompt-title').textContent = `Nenhum ${eventPeriod === 'upcoming' ? 'pr√≥ximo evento' : 'resultado'} na visualiza√ß√£o atual`;
                        document.getElementById('jump-text').textContent = `Ir para o ${eventPeriod === 'upcoming' ? 'pr√≥ximo evento' : '√∫ltimo resultado'} em`;
                        document.getElementById('jump-arrow').innerHTML = eventPeriod === 'upcoming' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>' : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>';
                        
                        const nextEventDate = nextEvent.dateObj;
                        document.getElementById('jump-date').textContent = nextEventDate.toLocaleString('pt-BR', { month: 'long', year: 'numeric' });
                        nextEventPrompt.classList.remove('hidden');
                        
                        document.getElementById('jump-to-event-btn').onclick = () => {
                            currentDate = new Date(nextEventDate.getFullYear(), nextEventDate.getMonth(), 1);
                            applyFiltersAndRender();
                        };
                    }
                }
            }
            
            function toggleReminder(eventId) {
                const reminderIndex = savedReminders.indexOf(eventId);
                if (reminderIndex > -1) {
                    savedReminders.splice(reminderIndex, 1);
                } else {
                    savedReminders.push(eventId);
                }
                localStorage.setItem('eventReminders', JSON.stringify(savedReminders));
                const openDate = detailsPanel.dataset.date;
                if (openDate) {
                    showDayDetails(openDate, allEventsData[eventPeriod]);
                }
            }

            function showDayDetails(dateStr, events) {
                detailsPanel.dataset.date = dateStr;
                const date = new Date(dateStr + 'T00:00:00');
                detailsTitle.textContent = `Eventos de ${date.toLocaleDateString('pt-BR', { dateStyle: 'full' })}`;
                const eventsOnDay = events.filter(e => e.dateEvent === dateStr);
                
                let contentHtml = '';
                if (eventsOnDay.length > 0) {
                    eventsOnDay.forEach(event => {
                        const sportName = getSportByLeagueId(event.idLeague);
                        const sportConfig = sportConfigs[sportName];
                        const isTopEvent = topTeams.includes(event.strHomeTeam) && topTeams.includes(event.strAwayTeam);
                        const isReminderSet = savedReminders.includes(event.idEvent);
                        
                        const finalBgImage = `url(${event.strThumb || sportConfig?.backgroundImage || ''})`;
                        const bgImageStyle = finalBgImage !== 'url()' ? `background-image: ${finalBgImage};` : '';
                        const timeDisplay = (event.strTime && event.strTime !== "00:00:00") ? event.strTime.substring(0, 5) : 'A definir';
                        const hotGameClass = isTopEvent ? 'border-2 border-amber-400' : '';

                        contentHtml += `
                            <div class="relative bg-gray-700 p-4 rounded-lg overflow-hidden ${hotGameClass}" style="${bgImageStyle} background-size: cover; background-position: center;">
                                <div class="absolute top-2 right-2 flex items-center gap-x-2 z-10">
                                    ${isTopEvent ? `<div class="bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full">üî•</div>` : ''}
                                    <button class="reminder-bell ${isReminderSet ? 'active' : ''}" data-event-id="${event.idEvent}" title="Ativar/Desativar lembrete">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 22a2.98 2.98 0 002.818-2H9.182A2.98 2.98 0 0012 22zm7-7v-5.273A6.994 6.994 0 0013 2.127V2a1 1 0 00-2 0v.127A6.994 6.994 0 005 9.727V15l-2 2v1h18v-1l-2-2z"/></svg>
                                    </button>
                                </div>
                                <div class="absolute inset-0 bg-black bg-opacity-60 backdrop-blur-sm"></div>
                                <div class="relative z-10">
                                    <p class="text-sm text-indigo-400 font-semibold">${event.strLeague}</p>
                                    <h3 class="text-lg font-bold mt-1 text-white">${event.strEvent}</h3>
                                    <p class="text-sm text-gray-300 mt-2">Hor√°rio: ${timeDisplay}</p>
                                    <p class="text-sm text-gray-300">Local: ${event.strVenue || 'A definir'}</p>
                                </div>
                            </div>`;
                    });
                } else {
                    contentHtml = '<p>Nenhum evento para este dia com os filtros atuais.</p>';
                }
                
                detailsContent.innerHTML = contentHtml;
                detailsPanel.classList.add('open');

                detailsContent.querySelectorAll('.reminder-bell').forEach(bell => {
                    bell.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleReminder(e.currentTarget.dataset.eventId);
                    });
                });
            }
            
            function getSportByLeagueId(leagueId) {
                for (const sportName in sportConfigs) {
                    if (sportConfigs[sportName].leagues) {
                        for (const leagueKey in sportConfigs[sportName].leagues) {
                            if (sportConfigs[sportName].leagues[leagueKey].id === leagueId) return sportName;
                        }
                    }
                }
                return null;
            }

            // --- INICIALIZA√á√ÉO ---
            document.querySelectorAll('input[name="event-period"]').forEach(radio => {
                radio.addEventListener('change', (e) => { 
                    eventPeriod = e.target.value; 
                    currentDate = new Date(); 
                    fetchAllEventsForPeriod(); 
                });
            });

            prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 2); applyFiltersAndRender(); });
            nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 2); applyFiltersAndRender(); });
            closeDetailsBtn.addEventListener('click', () => detailsPanel.classList.remove('open'));
            sidebarToggleBtn.addEventListener('click', () => sidebar.classList.toggle('collapsed'));
            viewModeSelect.addEventListener('change', applyFiltersAndRender);
            hotGamesToggle.addEventListener('change', applyFiltersAndRender);
            
            teamSearchInput.addEventListener('input', () => {
                const inputValue = teamSearchInput.value.toLowerCase();
                autocompleteResults.innerHTML = '';
                const events = allEventsData[eventPeriod] || [];

                if (inputValue.length > 0) {
                    const teamNames = [...new Set(events.flatMap(ev => [ev.strHomeTeam, ev.strAwayTeam]).filter(Boolean))];
                    const suggestions = teamNames.filter(name => name.toLowerCase().startsWith(inputValue)).sort().slice(0, 7);
                    
                    if (suggestions.length > 0) {
                        suggestions.forEach(name => {
                            const item = document.createElement('div');
                            item.className = 'p-3 cursor-pointer hover:bg-indigo-600';
                            item.textContent = name;
                            item.addEventListener('click', () => {
                                teamSearchInput.value = name;
                                autocompleteResults.classList.add('hidden');
                                if (viewModeSelect.value === 'todos') viewModeSelect.value = 'principais';
                                applyFiltersAndRender();
                            });
                            autocompleteResults.appendChild(item);
                        });
                        autocompleteResults.classList.remove('hidden');
                    } else {
                        autocompleteResults.classList.add('hidden');
                    }
                } else {
                    autocompleteResults.classList.add('hidden');
                }
                applyFiltersAndRender();
            });

            document.addEventListener('click', (e) => {
                if (!document.getElementById('team-search-container').contains(e.target)) {
                    autocompleteResults.classList.add('hidden');
                }
            });

            populateFilters();
            loadParticles(); // Agora carregar√° no novo cont√™iner
            await fetchAllEventsForPeriod();
        });
    </script>
</body>
</html>
